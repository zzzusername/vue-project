webpackJsonp([15],{"6Zft":function(t,e,n){"use strict";function i(t){n("FxGk")}Object.defineProperty(e,"__esModule",{value:!0});var a=n("mvHQ"),o=n.n(a),s=n("eDIg"),r={data:function(){return{contentHeight:0,title:"",feedback:!1,endDate:"",content:"",fileList:[],imgList:[]}},computed:{userInfo:function(){return this.$store.state.userInfo}},mounted:function(){var t=this;this.contentHeight=window.innerHeight-100,s.a.getNoticeInfo({schoolId:this.$route.params.schoolId,noticeId:this.$route.params.noticeId},function(e){t.title=e.noticeTitle,t.content=e.noticeBody,t.feedback=2===e.noticeReadFeedback,t.endDate=t.tools.formateTime(e.publishEndDate,"YYYY-MM-DD");for(var n=e.noticeImg.split(","),i=0;i<n.length;i++){var a=n[i];t.imgList.push({url:t.tools.cdn(a),status:"finished"})}for(var o=JSON.parse(e.noticeFile),s=0;s<o.length;s++){var r=o[s];t.fileList.push({name:r.name,url:t.tools.cdn(r.url),status:"finished"})}},function(e){t.error(e,"获取信息失败")})},methods:{handleImgChange:function(t,e){t.response&&this.imgList.push({url:this.tools.cdn(t.response.key),status:"finished"})},handleRemove:function(t,e){this.imgList=e},uploadImg:function(t){var e=this,n=this.uploadApi;n.getToken({type:"SCHOOL_NOTICE",args:this.$route.params.schoolId},function(e){n.uploadImage({token:e.result.token,file:t.file,key:e.result.path},function(e){t.onSuccess(e)},function(e){t.onError()})},function(n){t.onError(),e.error(n,"上传失败")})},error:function(t,e){var n=e;t.toUser&&(n=t.message),this.$message.error(n)},publish:function(){var t=this,e=[];if(this.fileList.length>0)for(var n in this.fileList)if(this.fileList.hasOwnProperty(n)){var i=this.fileList[n];e.push({name:i.name,url:i.url.slice("http://img.qunxiaozhu.com".length)})}var a="";if(this.imgList.length>0)for(var r=0;r<this.imgList.length;r++){var d=this.imgList[r],c=d.url.slice("http://img.qunxiaozhu.com".length);r!==this.imgList.length-1?a=a+c+",":a+=c}var l=this.$route.params.schoolId,h=this.$route.params.noticeId;return this.title?this.content?void s.a.editNotice({schoolId:l,noticeId:h,noticeTitle:this.title,noticeImg:a,noticeReadFeedback:this.feedback?2:1,publishEndDate:this.endDate+" 23:59",noticeBody:this.content,noticeFile:e.length>0?o()(e):void 0},function(e){t.$message({message:"修改成功",type:"success"}),t.$router.replace({name:"NoticeList"})},function(e){t.error(e,"修改失败")}):void this.warn("公告内容不能为空"):void this.warn("标题不能为空")},warn:function(t){this.$message({message:t,type:"warning"})},uploadFile:function(t){var e=this,n="";switch(this.getFileType(t.file.name)){case"doc":case"docx":n="SCHOOL_NOTICE_DOCX";break;case"xls":case"xlsx":n="SCHOOL_NOTICE_XLSX";break;case"pdf":n="SCHOOL_NOTICE_PDF";break;default:return void this.warn("文件格式不正确")}var i=this.uploadApi;i.getToken({type:n,args:this.$route.params.schoolId},function(e){i.uploadImage({token:e.result.token,file:t.file,key:e.result.path},function(e){t.onSuccess(e)},function(e){t.onError()})},function(n){t.onError(),e.error(n,"上传失败")})},getFileType:function(t){var e=t.lastIndexOf(".");return-1!==e?t.substring(e+1,t.length).toLowerCase():""},handleFileRemove:function(t,e){this.fileList=e},handleFileChange:function(t,e){t.response&&this.fileList.push({name:t.name,url:this.tools.cdn(t.response.key),status:"finished"})}}},d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"warpper"},[t._m(0,!1,!1),t._v(" "),n("div",{staticClass:"content"},[n("div",[n("span",{staticStyle:{"margin-right":"4em"}},[t._v("公告标题：")]),t._v(" "),n("el-input",{staticStyle:{width:"60vw"},attrs:{placeholder:"请输入"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),n("div",[n("span",{staticStyle:{"margin-right":"1em"}},[t._v("是否需要阅读反馈")]),t._v(" "),n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#666"},model:{value:t.feedback,callback:function(e){t.feedback=e},expression:"feedback"}})],1),t._v(" "),n("div",[n("span",{staticStyle:{"margin-right":"4em"}},[t._v("过期时间：")]),t._v(" "),n("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"请选择截止提交时间"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1),t._v(" "),n("div",[n("span",{staticStyle:{"margin-right":"4em","line-height":"132px"}},[t._v("公告说明：")]),t._v(" "),n("el-input",{staticStyle:{width:"60vw"},attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),t._v(" "),n("div",[n("el-upload",{attrs:{limit:9,action:"https://up-z2.qbox.me","list-type":"picture-card","http-request":t.uploadImg,"on-remove":t.handleRemove,"on-change":t.handleImgChange,"file-list":t.imgList}},[n("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),n("div",{staticStyle:{width:"30vw"}},[n("span",{staticStyle:{"margin-right":"4em"}},[t._v("附件上传：")]),t._v(" "),n("el-upload",{attrs:{action:"https://up-z2.qbox.me","http-request":t.uploadFile,"on-remove":t.handleFileRemove,"on-change":t.handleFileChange,"file-list":t.fileList}},[n("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),t._v(" "),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传doc/docx/xls/xlsx/pdf文件")])],1)],1)]),t._v(" "),n("div",{staticClass:"content",staticStyle:{padding:"5px 20px"}},[n("el-button",{attrs:{type:"primary"},on:{click:t.publish}},[t._v("修改")])],1)])},c=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header"},[n("span",[t._v("编辑公告")])])}],l={render:d,staticRenderFns:c},h=l,p=n("VU/8"),u=i,g=p(r,h,!1,u,"data-v-bdc4be42",null);e.default=g.exports},FxGk:function(t,e,n){var i=n("Mc8k");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n("rjj0")("08d9f2a8",i,!0)},Mc8k:function(t,e,n){e=t.exports=n("FZ+f")(!0),e.push([t.i,"\n.warpper[data-v-bdc4be42] {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  padding: 20px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.header[data-v-bdc4be42] {\n  background: #fff;\n  border-top: 4px solid #67c23a;\n  padding: 0 20px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.header span[data-v-bdc4be42] {\n  line-height: 60px;\n  font-size: 16px;\n  font-weight: 600;\n}\n.content[data-v-bdc4be42] {\n  background-color: #fff;\n  margin-top: 5px;\n}\n.content[data-v-bdc4be42] {\n  padding: 0 20px;\n}\n.content div[data-v-bdc4be42] {\n  padding: 5px 0;\n}\n.silder[data-v-bdc4be42] {\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  right: 0px;\n  width: 100vw;\n  height: 100vh;\n  margin-left: auto;\n  margin-right: auto;\n}\n.silder div[data-v-bdc4be42] {\n  width: 60%;\n  margin: auto;\n}\n","",{version:3,sources:["/Users/wangweidong/Desktop/code/web-qun/src/page/notice/Modify.vue"],names:[],mappings:";AACA;EACE,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,cAAc;EACd,+BAA+B;UACvB,uBAAuB;CAChC;AACD;EACE,iBAAiB;EACjB,8BAA8B;EAC9B,gBAAgB;EAChB,+BAA+B;UACvB,uBAAuB;CAChC;AACD;EACE,kBAAkB;EAClB,gBAAgB;EAChB,iBAAiB;CAClB;AACD;EACE,uBAAuB;EACvB,gBAAgB;CACjB;AACD;EACE,gBAAgB;CACjB;AACD;EACE,eAAe;CAChB;AACD;EACE,gBAAgB;EAChB,SAAS;EACT,UAAU;EACV,WAAW;EACX,aAAa;EACb,cAAc;EACd,kBAAkB;EAClB,mBAAmB;CACpB;AACD;EACE,WAAW;EACX,aAAa;CACd",file:"Modify.vue",sourcesContent:["\n.warpper[data-v-bdc4be42] {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  padding: 20px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.header[data-v-bdc4be42] {\n  background: #fff;\n  border-top: 4px solid #67c23a;\n  padding: 0 20px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.header span[data-v-bdc4be42] {\n  line-height: 60px;\n  font-size: 16px;\n  font-weight: 600;\n}\n.content[data-v-bdc4be42] {\n  background-color: #fff;\n  margin-top: 5px;\n}\n.content[data-v-bdc4be42] {\n  padding: 0 20px;\n}\n.content div[data-v-bdc4be42] {\n  padding: 5px 0;\n}\n.silder[data-v-bdc4be42] {\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  right: 0px;\n  width: 100vw;\n  height: 100vh;\n  margin-left: auto;\n  margin-right: auto;\n}\n.silder div[data-v-bdc4be42] {\n  width: 60%;\n  margin: auto;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=15.a937bccd2b9b88b76648.js.map